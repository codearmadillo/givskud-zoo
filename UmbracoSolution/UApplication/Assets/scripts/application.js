"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function a(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,e,i){return e&&a(t.prototype,e),i&&a(t,i),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var InteractiveMap=function(){function a(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;_classCallCheck(this,a),this.Viewport={Width:t.clientWidth,Height:t.clientHeight,Orientation:null},this.Zoom={Minimum:1,Maximum:4,Increase:.5},this.Zoom.Zoom=i&&i.Zoom&&i.Zoom>=this.Zoom.Minimum&&i.Zoom<=this.Zoom.Maximum?i.Zoom:1,this.Pan={Force:.09,IsEnabled:!0,Horizontal:{isEnabled:!0},Vertical:{isEnabled:!0},Element:{},XStart:null,YStart:null,mouseDrag:!1,touchDrag:!1},this.Position={x:i&&i.Position?i.Position.x:0,y:i&&i.Position?i.Position.y:0},this.Map={Source:e.Map,AspectRatio:null,Orientation:null,RealWorld:e.UsesRealWorld},this.Map.RealWorld&&(this.Map.Longitude=e.Longitude,this.Map.Latitude=e.Latitude,this.Map.Area={Longitude:this.Map.Longitude.End-this.Map.Longitude.Start,Latitude:this.Map.Latitude.Start-this.Map.Latitude.End},this.Map.Distances={hor:this.GetGeographicDistance(this.Map.Longitude.Start,this.Map.Latitude.Start-(this.Map.Latitude.Start-this.Map.Latitude.End)/2,this.Map.Longitude.End,this.Map.Latitude.Start-(this.Map.Latitude.Start-this.Map.Latitude.End)/2),ver:this.GetGeographicDistance(this.Map.Longitude.End-(this.Map.Latitude.End-this.Map.Latitude.Start)/2,this.Map.Latitude.Start,this.Map.Longitude.End-(this.Map.Latitude.End-this.Map.Latitude.Start)/2,this.Map.Latitude.End)},this.Map.Step=1,this.CalculateDistances()),this.Elements={Parent:t},this.SynchQueue=Array(),this.InitiatedCall=!1,this.Animations={},this.Markers={},this.Load()}return _createClass(a,[{key:"Load",value:function(){var e=this;this.Elements.Parent.className=this.Elements.Parent.className+" iamap",this.Elements.Loader=this.Loader(),this.Elements.Parent.appendChild(this.Elements.Loader);var i=new Image;i.addEventListener("load",function(t){1<i.width/i.height?(e.Map.Orientation="horizontal",e.Map.AspectRatio=i.height/i.width):(e.Map.Orientation="vertical",e.Map.AspectRatio=i.width/i.height),e.Render(),window.addEventListener("resize",function(t){e.CalculateDistances(),e.Render()})}),i.src=this.Map.Source}},{key:"Render",value:function(){if(this.Viewport={Width:this.Elements.Parent.clientWidth,Height:this.Elements.Parent.clientHeight,Orientation:this.Elements.Parent.clientWidth>this.Elements.Parent.clientHeight?"horizontal":"vertical"},!this.Elements.Map){var t=document.createElement("div");t.className="iamap-maplayer",t.Styles({position:"relative","background-image":"url('"+this.Map.Source+"')","background-repeat":"no-repeat","background-position":"center center","z-index":50}),this.Elements.Map=t,this.Elements.Parent.appendChild(this.Elements.Map),this.Elements.Loader&&this.Elements.Parent.removeChild(this.Elements.Loader),this.RunSynchQueue(),this.CreateControllers()}var e={left:0,top:0};if("horizontal"==this.Viewport.Orientation)var i=this.Viewport.Height*this.Zoom.Zoom+"px",a=(this.Viewport.Height/this.Map.AspectRatio*this.Zoom.Zoom).toFixed(2)+"px";else a=this.Viewport.Width*this.Zoom.Zoom+"px",i=(this.Viewport.Width*this.Map.AspectRatio*this.Zoom.Zoom).toFixed(2)+"px";var o="horizontal"==this.Map.Orientation?"100% auto":"auto 100%";this.Pan.Horizontal.isEnabled=!0,this.Pan.Vertical.isEnabled=!0,"horizontal"==this.Map.Orientation?parseFloat(a)<=this.Viewport.Width?(e.left=(this.Viewport.Width-parseFloat(a)).toFixed(2)/2,e.top=(this.Viewport.Height-parseFloat(i)).toFixed(2)/2,this.Elements.Map.style.left=e.left+"px",this.Elements.Map.style.top=e.top+"px"):parseFloat(i)<this.Viewport.Height&&(e.top=(this.Viewport.Height-parseFloat(i)).toFixed(2)/2,this.Elements.Map.style.top=e.top+"px"):parseFloat(i)<=this.Viewport.Height?(e.left=(this.Viewport.Width-parseFloat(a)).toFixed(2)/2,e.top=(this.Viewport.Height-parseFloat(i)).toFixed(2)/2,this.Elements.Map.style.left=e.left+"px",this.Elements.Map.style.top=e.top+"px"):parseFloat(a)<this.Viewport.Width&&(e.left=(this.Viewport.Width-parseFloat(a)).toFixed(2)/2,this.Elements.Map.style.top=e.top+"px"),parseFloat(a)<=this.Viewport.Width&&(this.Pan.Horizontal.isEnabled=!1),parseFloat(i)<=this.Viewport.Height&&(this.Pan.Vertical.isEnabled=!1),this.Elements.Map.style.backgroundSize=o,this.Elements.Map.style.width=a,this.Elements.Map.style.height=i;var s=parseFloat(this.Elements.Map.style.width),n=parseFloat(this.Elements.Map.style.height);if(this.Map.StepSize.hor.px||(this.Map.StepSize.hor.px=s/(this.Map.Distances.hor/this.Map.Step)),this.Map.StepSize.ver.px||(this.Map.StepSize.ver.px=n/(this.Map.Distances.ver/this.Map.Step)),this.Markers)for(var r in this.Markers){var l=this.Markers[r].items;for(var h in l){var p=l[h];if(!p.Element){var u=document.createElement("span");u.style.position="absolute",u.className="iamap-marker",u.style.width="7px",u.style.height=u.style.width,u.style.borderRadius="calc("+u.style.width+" / 2)",u.style.backgroundColor="red",this.Markers[r].items[h].Element=u,this.Elements.Markers.appendChild(this.Markers[r].items[h].Element)}this.Markers[r].items[h].Element.style.visibility=p.render?"unset":"hidden";var d=Math.abs(this.Map.Longitude.Start-p.position.x),c=Math.abs(this.Map.Latitude.Start-p.position.y);this.Markers[r].items[h].Element.style.left=Math.abs(d/this.Map.StepSize.hor.coords*this.Map.StepSize.hor.px)*this.Zoom.Zoom+"px",this.Markers[r].items[h].Element.style.top=Math.abs(c/this.Map.StepSize.ver.coords*this.Map.StepSize.ver.px)*this.Zoom.Zoom+"px"}}return this.Pan.Boundaries={top:0,right:-1*(this.Elements.Map.offsetWidth-this.Viewport.Width),bottom:-1*(this.Elements.Map.offsetHeight-this.Viewport.Height),left:0},!0}},{key:"Loader",value:function(){var t=document.createElement("span");return t.className="iamap-loader",t.textContent="Loading resources",t}},{key:"GetGeographicDistance",value:function(t,e,i,a){var o=this.Deg2Rad(a-e),s=this.Deg2Rad(i-t),n=Math.sin(o/2)*Math.sin(o/2)+Math.cos(this.Deg2Rad(e))*Math.cos(this.Deg2Rad(a))*Math.sin(s/2)*Math.sin(s/2);return 6391*(2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n)))*1e3}},{key:"Deg2Rad",value:function(t){return t*(Math.PI/180)}},{key:"CalculateDistances",value:function(){this.Map.StepSize={hor:{coords:this.Map.Area.Longitude/(this.Map.Distances.hor/this.Map.Step),px:null},ver:{coords:this.Map.Area.Latitude/(this.Map.Distances.ver/this.Map.Step),px:null}}}},{key:"MapShowCurrentLocation",value:function(){var i=this;return navigator&&navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){var e=t.coords;i.Markers.location?i.Markers.location.items.location.position={x:e.longitude,y:e.latitude}:i.AddMarkers(Array({group:{id:"location",slug:"location",label:"Location",icon:null,controller:!1},id:"location",label:"My location",listener:!1,position:{x:e.longitude,y:e.latitude}}))},this.MapLocationError,{enableHighAccuracy:!0,maximumAge:0}):this.MapLocationError(null)}},{key:"MapLocationError",value:function(t){switch(t.code){case t.PERMISSION_DENIED:console.log("User denied the request for Geolocation.");break;case t.POSITION_UNAVAILABLE:console.log("Location information is unavailable.");break;case t.TIMEOUT:console.log("The request to get user location timed out.");break;case t.UNKNOWN_ERROR:default:console.log("An unknown error occurred.")}return!1}},{key:"MapControlZoom",value:function(t){var e=this.Position.x/this.Zoom.Zoom,i=this.Position.y/this.Zoom.Zoom;return this.Zoom.Zoom=t?this.Zoom.Zoom<this.Zoom.Maximum?this.Zoom.Zoom+this.Zoom.Increase:this.Zoom.Zoom:this.Zoom.Zoom>this.Zoom.Minimum?this.Zoom.Zoom-this.Zoom.Increase:this.Zoom.Zoom,this.Position.x=e*this.Zoom.Zoom,this.Position.y=i*this.Zoom.Zoom,this.Render()}},{key:"ZoomTo",value:function(t){return this.Zoom.Zoom=t,this.Render()}},{key:"MapControlPan",value:function(t,e){if(!this.Pan.Vertical.isEnabled&&!this.Pan.Horizontal.isEnabled)return!1;var i=parseFloat((t-this.Pan.XStart).toFixed(2)),a=parseFloat((e-this.Pan.YStart).toFixed(2));this.Pan.XStart=t,this.Pan.YStart=e;var o=this.Elements.Map.offsetLeft?this.Elements.Map.offsetLeft:0,s=this.Elements.Map.offsetTop?this.Elements.Map.offsetTop:0;this.Pan.Horizontal.isEnabled&&(this.Elements.Map.style.left=parseFloat(o+i)+"px"),this.Pan.Vertical.isEnabled&&(this.Elements.Map.style.top=parseFloat(s+a)+"px")}},{key:"MapControlPanCallback",value:function(){this.Pan.Boundaries={top:0,right:-1*(this.Elements.Map.offsetWidth-this.Viewport.Width),bottom:-1*(this.Elements.Map.offsetHeight-this.Viewport.Height),left:0};var t={iterations:1,duration:250},e=this;if(this.Pan.Horizontal.isEnabled&&(this.Elements.Map.offsetLeft<this.Pan.Boundaries.right||this.Elements.Map.offsetLeft>this.Pan.Boundaries.left)){if(this.Pan.Horizontal.isEnabled=!1,this.Elements.Map.offsetLeft<this.Pan.Boundaries.right)var i=Array({left:this.Elements.Map.offsetLeft+"px"},{left:this.Pan.Boundaries.right+"px"}),a={left:this.Pan.Boundaries.right+"px"};if(this.Elements.Map.offsetLeft>this.Pan.Boundaries.left)i=Array({left:this.Elements.Map.offsetLeft+"px"},{left:this.Pan.Boundaries.left+"px"}),a={left:this.Pan.Boundaries.left+"px"};this.Elements.Map.Animation(i,t,function(){e.Elements.Map.Styles(a)}),this.Pan.Horizontal.isEnabled=!0}if(this.Pan.Vertical.isEnabled&&(this.Elements.Map.offsetTop<this.Pan.Boundaries.bottom||this.Elements.Map.offsetTop>this.Pan.Boundaries.top)){if(this.Pan.Vertical.isEnabled=!1,this.Elements.Map.offsetTop<this.Pan.Boundaries.bottom)i=Array({top:this.Elements.Map.offsetTop+"px"},{top:this.Pan.Boundaries.bottom+"px"}),a={top:this.Pan.Boundaries.bottom+"px"};if(this.Elements.Map.offsetTop>this.Pan.Boundaries.top)i=Array({top:this.Elements.Map.offsetTop+"px"},{top:this.Pan.Boundaries.top+"px"}),a={top:this.Pan.Boundaries.top+"px"};this.Elements.Map.Animation(i,t,function(){e.Elements.Map.Styles(a)}),this.Pan.Vertical.isEnabled=!0}}},{key:"MoveToLocation",value:function(t){if(this.Markers.hasOwnProperty(t.groupId)&&this.Markers[t.groupId].items.hasOwnProperty(t.itemId)){this.ZoomTo(3);var e=this.Markers[t.groupId].items[t.itemId],i=Math.abs(e.position.x-this.Map.Longitude.Start)/Map.Map.StepSize.hor.coords*Map.Map.StepSize.hor.px*this.Zoom.Zoom*-1,a=Math.abs(e.position.y-this.Map.Latitude.Start)/Map.Map.StepSize.ver.coords*Map.Map.StepSize.ver.px*this.Zoom.Zoom*-1,o={h:i+(this.Viewport.Width/2-e.Element.offsetWidth/2),v:a+(this.Viewport.Height/2-e.Element.offsetHeight/2)};return o.h>this.Pan.Boundaries.left?o.h=this.Pan.Boundaries.left:o.h<this.Pan.Boundaries.right&&(o.h=this.Pan.Boundaries.right),o.v>this.Pan.Boundaries.top?o.v=this.Pan.Boundaries.top:o.v<this.Pan.Boundaries.bottom&&(o.v=this.Pan.Boundaries.bottom),this.Elements.Map.Styles({left:o.h+"px",top:o.v+"px"}),this.HighlightMarker(e.id,e.group.id),this.Render()}return!1}},{key:"MapCoverArea",value:function(t,e,i,a){}},{key:"AddMarkers",value:function(t,e){if(!this.Elements.Map)return this.AddToSynchQueue("AddMarkers",this,Array(t));var i=e=e||this;if(t.forEach(function(t){i.Markers[t.group.id]||(i.Markers[t.group.id]={id:t.group.id,label:t.group.label,slug:t.group.slug,icon:t.group.icon,items:{}}),i.Markers[t.group.id].items[t.id]?console.log("Warning: Duplicate marker ID"):i.Markers[t.group.id].items[t.id]=new InteractiveMapMarker({id:t.id,group:t.group,label:t.label,position:t.position,desc:t.description?t.description:null})}),!e.Elements.Markers){var a=document.createElement("div");a.className="iamap-markerslayer",a.style.position="absolute",a.style.left=0,a.style.top=0,a.style.right=0,a.style.bottom=0,e.Elements.Markers=a,e.Elements.Map.appendChild(e.Elements.Markers)}e.Render()}},{key:"HideMarkers",value:function(t){var e=this.FilterMarkers(t).items;if(!e)return!1;for(var i in e){var a=e[i].id,o=e[i].group.id;this.Markers[o]&&this.Markers[o].items[a]&&(this.Markers[o].items[a].render=!1)}this.Render()}},{key:"ShowMarkers",value:function(t){var e=this.FilterMarkers(t).items;if(!e)return!1;for(var i in e){var a=e[i].id,o=e[i].group.id;this.Markers[o]&&this.Markers[o].items[a]&&(this.Markers[o].items[a].render=!0)}this.Render()}},{key:"FilterMarkers",value:function(t){if(!t);var e=void 0;switch(t.type){case"group":e=t.group?this.Markers[t.group]:null;break;case"marker":e=t.group&&t.id?this.Markers[t.group].items[t.id]:null;break;case"all":default:e=this.Markers}return null!=e&&e}},{key:"HighlightMarker",value:function(t,e){return console.log("Highlighting marker ",t," from group ",e)}},{key:"CreateControllers",value:function(){var a=this;this.Elements.Controllers={};var t=document.createElement("div");t.Properties({className:"iamap-controllerslayer"}),t.Styles({position:"absolute",bottom:"15px",right:"15px","z-index":100,"text-align":"right"}),this.Elements.Controllers.Parent=t,this.Elements.Parent.appendChild(this.Elements.Controllers.Parent);var e=document.createElement("span");e.Styles({position:"relative",display:"inline-block",width:"32px",height:"32px","background-size":"32px 32px","background-image":'url("/Assets/images/map.icon.location.svg")',"margin-right":"32px"}),e.addEventListener("click",function(t){t.preventDefault(),a.MapShowCurrentLocation()}),this.Elements.Controllers.Location=e,this.Elements.Controllers.Parent.appendChild(this.Elements.Controllers.Location);var i=document.createElement("span");i.Styles({position:"relative",display:"inline-block",width:"32px",height:"32px","background-size":"32px 32px","background-image":'url("/Assets/images/map.icon.zoom-in.svg")'}),i.addEventListener("click",function(t){t.preventDefault(),a.MapControlZoom(!0)}),this.Elements.Controllers.ZoomIn=i,this.Elements.Controllers.Parent.appendChild(this.Elements.Controllers.ZoomIn);var o=document.createElement("span");return o.Styles({position:"relative",display:"inline-block",width:"32px",height:"32px","background-size":"32px 32px","background-image":'url("/Assets/images/map.icon.zoom-out.svg")',"margin-left":"6px"}),o.addEventListener("click",function(t){t.preventDefault(),a.MapControlZoom(!1)}),this.Elements.Controllers.ZoomOut=o,this.Elements.Controllers.Parent.appendChild(this.Elements.Controllers.ZoomOut),this.Elements.Map.addMultipleListeners("mousedown","touchstart",function(t){switch(t.preventDefault(),t.type){case"mousedown":a.Pan.mouseDrag=!0,a.Pan.XStart=parseFloat((t.clientX-a.Elements.Parent.offsetLeft).toFixed(2)),a.Pan.YStart=parseFloat((t.clientY-a.Elements.Parent.offsetTop).toFixed(2));break;case"touchstart":a.Pan.touchDrag=!0,a.Pan.XStart=parseFloat((t.changedTouches[0].clientX-a.Elements.Parent.offsetLeft).toFixed(2)),a.Pan.YStart=parseFloat((t.changedTouches[0].clientY-a.Elements.Parent.offsetTop).toFixed(2))}}),this.Elements.Map.addMultipleListeners("mousemove","touchmove",function(t){switch(t.preventDefault(),t.type){case"mousemove":if(!a.Pan.mouseDrag||!a.Pan.IsEnabled)return!1;var e=window.event.clientX,i=window.event.clientY;break;case"touchmove":if(!a.Pan.touchDrag||!a.Pan.IsEnabled)return!1;e=parseFloat(window.event.changedTouches[0].clientX.toFixed(2)),i=parseFloat(window.event.changedTouches[0].clientY.toFixed(2))}a.MapControlPan(e,i)}),this.Elements.Map.addMultipleListeners("mouseup","mouseleave","touchend",function(t){t.preventDefault(),a.Pan.touchDrag=!1,a.Pan.mouseDrag=!1,a.MapControlPanCallback(),a.Pan.XStart=null,a.Pan.YStart=null}),!0}},{key:"AddToSynchQueue",value:function(t,e,i){this.SynchQueue.push({f:t,c:e?this:null,data:Array.isArray(i)?i:Array(i)})}},{key:"RunSynchQueue",value:function(){var i=this;this.SynchQueue.forEach(function(t,e){t.c&&t.data.push(i),i[t.f].apply(i,t.data),i.SynchQueue.splice(e,1)})}}]),a}(),InteractiveMapMarker=function(){function e(t){_classCallCheck(this,e),t&&t.group&&t.id&&t.position&&t.label?(this.id=t.id,this.group=t.group,this.position=t.position,this.label=t.label,this.desc=t.desc?t.desc:"",this.render=!0):console.log("Marker error: The definition of config incorrect")}return _createClass(e,[{key:"cfgError",value:function(t){return alert("The field "+t+" is missing from configuration")}},{key:"getPosition",value:function(){return this.position}}]),e}(),Popup=function(){function i(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return _classCallCheck(this,i),this.dom=this.todom(t),this.cls=e,this.render()}return _createClass(i,[{key:"todom",value:function(t){var s=Array();return t.forEach(function(t){var o,e,i=t.tag.split("@"),a=1==i.length?document.createElement(i):(o=document.createElement(i[0]),(e=i).shift(),e.forEach(function(t){var e=t.split("="),i=e[0],a=e[1].replace(";"," ");return o.setAttribute(i,a)}),o);t=document.createTextNode(t.text);return a.appendChild(t),s.push(a)}),s}},{key:"render",value:function(){var e=document.createElement("div");e.className="overlay__window";var i=document.createElement("div");i.className="popup__content";var t=document.createElement("div");return t.className="popup__outer",this.cls&&t.addEventListener("click",function(t){e.remove()}),this.dom.forEach(function(t){i.appendChild(t)}),e.append(i,t),document.body.appendChild(e)}}]),i}(),QuizModule={Init:function(){}},Configuration={IsLocationServiceEnabled:!0,LocationDummyOverride:!0};Element.prototype.Animation=function(t,e,i){var a=void 0;if(i)if(e&&e.iterations&&1==e.iterations)a=setTimeout(function(){i()},e.duration?e.duration:0);else if(1<e.iterations&&"Infinity"!==e.iterations){var o=0;a=setInterval(function(){o++,i(),o==e.iterations&&clearInterval(a)},e.duration?e.duration:0)}else a=setInterval(function(){i()},e.duration?e.duration:0);return this.animate(t,e)},Element.prototype.append=function(){for(var t=0;t<arguments.length;t++)this.appendChild(arguments[t])},Element.prototype.prepend=function(){for(var t=0;t<arguments.length;t++)console.log(arguments[t]),this.innerHTML=arguments[t].outerHTML+this.innerHTML},HTMLElement.prototype.Styles=function(t){for(var e in t)this.style[e]=t[e];return this},Element.prototype.addMultipleListeners=function(t){if(arguments.length<=1)return!1;for(var e=0;e<arguments.length-1;e++)this.addEventListener(arguments[e],arguments[arguments.length-1])},Element.prototype.Properties=function(t){for(var e in t)this[e]=t[e];return!0},HTMLDocument.prototype.createTextElement=function(t,e){var i=document.createElement(t),a=document.createTextNode(e);return i.appendChild(a),i};